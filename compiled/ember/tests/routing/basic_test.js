'use strict';var _slicedToArray=(function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n = (_s = _i.next()).done);_n = true) {_arr.push(_s.value);if(i && _arr.length === i)break;}}catch(err) {_d = true;_e = err;}finally {try{if(!_n && _i['return'])_i['return']();}finally {if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else {throw new TypeError('Invalid attempt to destructure non-iterable instance');}};})();function _interopRequireDefault(obj){return obj && obj.__esModule?obj:{'default':obj};}require('ember');var _emberMetalCore=require('ember-metal/core');var _emberMetalCore2=_interopRequireDefault(_emberMetalCore);var _emberMetalFeatures=require('ember-metal/features');var _emberMetalFeatures2=_interopRequireDefault(_emberMetalFeatures);var _emberMetalProperty_get=require('ember-metal/property_get');var _emberMetalProperty_set=require('ember-metal/property_set');var _emberViewsSystemAction_manager=require('ember-views/system/action_manager');var _emberViewsSystemAction_manager2=_interopRequireDefault(_emberViewsSystemAction_manager);var _emberViewsViewsView=require('ember-views/views/view');var _emberViewsViewsView2=_interopRequireDefault(_emberViewsViewsView);var _emberRuntimeControllersArray_controller=require('ember-runtime/controllers/array_controller');var _emberHtmlbarsCompat=require('ember-htmlbars/compat');var _emberHtmlbarsCompat2=_interopRequireDefault(_emberHtmlbarsCompat);var compile=_emberHtmlbarsCompat2['default'].compile;var trim=_emberMetalCore2['default'].$.trim;var Router,App,router,registry,container,originalLoggerError;function bootApplication(){router = container.lookup('router:main');_emberMetalCore2['default'].run(App,'advanceReadiness');}function handleURL(path){return _emberMetalCore2['default'].run(function(){return router.handleURL(path).then(function(value){ok(true,'url: `' + path + '` was handled');return value;},function(reason){ok(false,'failed to visit:`' + path + '` reason: `' + QUnit.jsDump.parse(reason));throw reason;});});}function handleURLAborts(path){_emberMetalCore2['default'].run(function(){router.handleURL(path).then(function(value){ok(false,'url: `' + path + '` was NOT to be handled');},function(reason){ok(reason && reason.message === 'TransitionAborted','url: `' + path + '` was to be aborted');});});}function handleURLRejectsWith(path,expectedReason){_emberMetalCore2['default'].run(function(){router.handleURL(path).then(function(value){ok(false,'expected handleURLing: `' + path + '` to fail');},function(reason){equal(expectedReason,reason);});});}QUnit.module('Basic Routing',{setup:function setup(){_emberMetalCore2['default'].run(function(){App = _emberMetalCore2['default'].Application.create({name:'App',rootElement:'#qunit-fixture'});App.deferReadiness();App.Router.reopen({location:'none'});Router = App.Router;App.LoadingRoute = _emberMetalCore2['default'].Route.extend({});registry = App.registry;container = App.__container__;_emberMetalCore2['default'].TEMPLATES.application = compile('{{outlet}}');_emberMetalCore2['default'].TEMPLATES.home = compile('<h3>Hours</h3>');_emberMetalCore2['default'].TEMPLATES.homepage = compile('<h3>Megatroll</h3><p>{{model.home}}</p>');_emberMetalCore2['default'].TEMPLATES.camelot = compile('<section><h3>Is a silly place</h3></section>');originalLoggerError = _emberMetalCore2['default'].Logger.error;});},teardown:function teardown(){_emberMetalCore2['default'].run(function(){App.destroy();App = null;_emberMetalCore2['default'].TEMPLATES = {};_emberMetalCore2['default'].Logger.error = originalLoggerError;});}});QUnit.test('warn on URLs not included in the route set',function(){Router.map(function(){this.route('home',{path:'/'});});bootApplication();expectAssertion(function(){_emberMetalCore2['default'].run(function(){router.handleURL('/what-is-this-i-dont-even');});},'The URL \'/what-is-this-i-dont-even\' did not match any routes in your application');});QUnit.test('The Homepage',function(){Router.map(function(){this.route('home',{path:'/'});});App.HomeRoute = _emberMetalCore2['default'].Route.extend({});var currentPath;App.ApplicationController = _emberMetalCore2['default'].Controller.extend({currentPathDidChange:_emberMetalCore2['default'].observer('currentPath',function(){currentPath = (0,_emberMetalProperty_get.get)(this,'currentPath');})});bootApplication();equal(currentPath,'home');equal(_emberMetalCore2['default'].$('h3:contains(Hours)','#qunit-fixture').length,1,'The home template was rendered');});QUnit.test('The Home page and the Camelot page with multiple Router.map calls',function(){Router.map(function(){this.route('home',{path:'/'});});Router.map(function(){this.route('camelot',{path:'/camelot'});});App.HomeRoute = _emberMetalCore2['default'].Route.extend({});App.CamelotRoute = _emberMetalCore2['default'].Route.extend({});var currentPath;App.ApplicationController = _emberMetalCore2['default'].Controller.extend({currentPathDidChange:_emberMetalCore2['default'].observer('currentPath',function(){currentPath = (0,_emberMetalProperty_get.get)(this,'currentPath');})});App.CamelotController = _emberMetalCore2['default'].Controller.extend({currentPathDidChange:_emberMetalCore2['default'].observer('currentPath',function(){currentPath = (0,_emberMetalProperty_get.get)(this,'currentPath');})});bootApplication();handleURL('/camelot');equal(currentPath,'camelot');equal(_emberMetalCore2['default'].$('h3:contains(silly)','#qunit-fixture').length,1,'The camelot template was rendered');handleURL('/');equal(currentPath,'home');equal(_emberMetalCore2['default'].$('h3:contains(Hours)','#qunit-fixture').length,1,'The home template was rendered');});QUnit.test('The Homepage with explicit template name in renderTemplate',function(){Router.map(function(){this.route('home',{path:'/'});});App.HomeRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render('homepage');}});bootApplication();equal(_emberMetalCore2['default'].$('h3:contains(Megatroll)','#qunit-fixture').length,1,'The homepage template was rendered');});QUnit.test('An alternate template will pull in an alternate controller',function(){Router.map(function(){this.route('home',{path:'/'});});App.HomeRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render('homepage');}});App.HomepageController = _emberMetalCore2['default'].Controller.extend({model:{home:'Comes from homepage'}});bootApplication();equal(_emberMetalCore2['default'].$('h3:contains(Megatroll) + p:contains(Comes from homepage)','#qunit-fixture').length,1,'The homepage template was rendered');});QUnit.test('An alternate template will pull in an alternate controller instead of controllerName',function(){Router.map(function(){this.route('home',{path:'/'});});App.HomeRoute = _emberMetalCore2['default'].Route.extend({controllerName:'foo',renderTemplate:function renderTemplate(){this.render('homepage');}});App.FooController = _emberMetalCore2['default'].Controller.extend({model:{home:'Comes from Foo'}});App.HomepageController = _emberMetalCore2['default'].Controller.extend({model:{home:'Comes from homepage'}});bootApplication();equal(_emberMetalCore2['default'].$('h3:contains(Megatroll) + p:contains(Comes from homepage)','#qunit-fixture').length,1,'The homepage template was rendered');});QUnit.test('The template will pull in an alternate controller via key/value',function(){Router.map(function(){this.route('homepage',{path:'/'});});App.HomepageRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render({controller:'home'});}});App.HomeController = _emberMetalCore2['default'].Controller.extend({model:{home:'Comes from home.'}});bootApplication();equal(_emberMetalCore2['default'].$('h3:contains(Megatroll) + p:contains(Comes from home.)','#qunit-fixture').length,1,'The homepage template was rendered from data from the HomeController');});QUnit.test('The Homepage with explicit template name in renderTemplate and controller',function(){Router.map(function(){this.route('home',{path:'/'});});App.HomeController = _emberMetalCore2['default'].Controller.extend({model:{home:'YES I AM HOME'}});App.HomeRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render('homepage');}});bootApplication();equal(_emberMetalCore2['default'].$('h3:contains(Megatroll) + p:contains(YES I AM HOME)','#qunit-fixture').length,1,'The homepage template was rendered');});QUnit.test('Model passed via renderTemplate model is set as controller\'s model',function(){_emberMetalCore2['default'].TEMPLATES['bio'] = compile('<p>{{model.name}}</p>');App.BioController = _emberMetalCore2['default'].Controller.extend();Router.map(function(){this.route('home',{path:'/'});});App.HomeRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render('bio',{model:{name:'emberjs'}});}});bootApplication();equal(_emberMetalCore2['default'].$('p:contains(emberjs)','#qunit-fixture').length,1,'Passed model was set as controllers model');});QUnit.test('Renders correct view with slash notation',function(){_emberMetalCore2['default'].TEMPLATES['home/page'] = compile('<p>{{view.name}}</p>');Router.map(function(){this.route('home',{path:'/'});});App.HomeRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render('home/page');}});App.HomePageView = _emberViewsViewsView2['default'].extend({name:'Home/Page'});bootApplication();equal(_emberMetalCore2['default'].$('p:contains(Home/Page)','#qunit-fixture').length,1,'The homepage template was rendered');});QUnit.test('Renders the view given in the view option',function(){_emberMetalCore2['default'].TEMPLATES['home'] = compile('<p>{{view.name}}</p>');Router.map(function(){this.route('home',{path:'/'});});App.HomeRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render({view:'homePage'});}});App.HomePageView = _emberViewsViewsView2['default'].extend({name:'Home/Page'});bootApplication();equal(_emberMetalCore2['default'].$('p:contains(Home/Page)','#qunit-fixture').length,1,'The homepage view was rendered');});QUnit.test('render does not replace templateName if user provided',function(){Router.map(function(){this.route('home',{path:'/'});});_emberMetalCore2['default'].TEMPLATES.the_real_home_template = compile('<p>THIS IS THE REAL HOME</p>');App.HomeView = _emberViewsViewsView2['default'].extend({templateName:'the_real_home_template'});App.HomeController = _emberMetalCore2['default'].Controller.extend();App.HomeRoute = _emberMetalCore2['default'].Route.extend();bootApplication();equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'THIS IS THE REAL HOME','The homepage template was rendered');});QUnit.test('render does not replace template if user provided',function(){Router.map(function(){this.route('home',{path:'/'});});App.HomeView = _emberViewsViewsView2['default'].extend({template:compile('<p>THIS IS THE REAL HOME</p>')});App.HomeController = _emberMetalCore2['default'].Controller.extend();App.HomeRoute = _emberMetalCore2['default'].Route.extend();bootApplication();_emberMetalCore2['default'].run(function(){router.handleURL('/');});equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'THIS IS THE REAL HOME','The homepage template was rendered');});QUnit.test('render uses templateName from route',function(){Router.map(function(){this.route('home',{path:'/'});});_emberMetalCore2['default'].TEMPLATES.the_real_home_template = compile('<p>THIS IS THE REAL HOME</p>');App.HomeController = _emberMetalCore2['default'].Controller.extend();App.HomeRoute = _emberMetalCore2['default'].Route.extend({templateName:'the_real_home_template'});bootApplication();equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'THIS IS THE REAL HOME','The homepage template was rendered');});QUnit.test('defining templateName allows other templates to be rendered',function(){Router.map(function(){this.route('home',{path:'/'});});_emberMetalCore2['default'].TEMPLATES.alert = compile('<div class=\'alert-box\'>Invader!</div>');_emberMetalCore2['default'].TEMPLATES.the_real_home_template = compile('<p>THIS IS THE REAL HOME</p>{{outlet \'alert\'}}');App.HomeController = _emberMetalCore2['default'].Controller.extend();App.HomeRoute = _emberMetalCore2['default'].Route.extend({templateName:'the_real_home_template',actions:{showAlert:function showAlert(){this.render('alert',{into:'home',outlet:'alert'});}}});bootApplication();equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'THIS IS THE REAL HOME','The homepage template was rendered');_emberMetalCore2['default'].run(function(){router.send('showAlert');});equal(_emberMetalCore2['default'].$('.alert-box','#qunit-fixture').text(),'Invader!','Template for alert was render into outlet');});QUnit.test('Specifying a name to render should have precedence over everything else',function(){Router.map(function(){this.route('home',{path:'/'});});App.HomeController = _emberMetalCore2['default'].Controller.extend();App.HomeRoute = _emberMetalCore2['default'].Route.extend({templateName:'home',controllerName:'home',viewName:'home',renderTemplate:function renderTemplate(){this.render('homepage');}});App.HomeView = _emberViewsViewsView2['default'].extend({template:compile('<h3>This should not be rendered</h3><p>{{model.home}}</p>')});App.HomepageController = _emberMetalCore2['default'].Controller.extend({model:{home:'Tinytroll'}});App.HomepageView = _emberViewsViewsView2['default'].extend({layout:compile('<span>Outer</span>{{yield}}<span>troll</span>'),templateName:'homepage'});bootApplication();equal(_emberMetalCore2['default'].$('h3','#qunit-fixture').text(),'Megatroll','The homepage template was rendered');equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'Tinytroll','The homepage controller was used');equal(_emberMetalCore2['default'].$('span','#qunit-fixture').text(),'Outertroll','The homepage view was used');});QUnit.test('The Homepage with a `setupController` hook',function(){Router.map(function(){this.route('home',{path:'/'});});App.HomeRoute = _emberMetalCore2['default'].Route.extend({setupController:function setupController(controller){(0,_emberMetalProperty_set.set)(controller,'hours',_emberMetalCore2['default'].A(['Monday through Friday: 9am to 5pm','Saturday: Noon to Midnight','Sunday: Noon to 6pm']));}});_emberMetalCore2['default'].TEMPLATES.home = compile('<ul>{{#each hours as |entry|}}<li>{{entry}}</li>{{/each}}</ul>');bootApplication();equal(_emberMetalCore2['default'].$('ul li','#qunit-fixture').eq(2).text(),'Sunday: Noon to 6pm','The template was rendered with the hours context');});QUnit.test('The route controller is still set when overriding the setupController hook',function(){Router.map(function(){this.route('home',{path:'/'});});App.HomeRoute = _emberMetalCore2['default'].Route.extend({setupController:function setupController(controller){}});registry.register('controller:home',_emberMetalCore2['default'].Controller.extend());bootApplication();deepEqual(container.lookup('route:home').controller,container.lookup('controller:home'),'route controller is the home controller');});QUnit.test('The route controller can be specified via controllerName',function(){Router.map(function(){this.route('home',{path:'/'});});_emberMetalCore2['default'].TEMPLATES.home = compile('<p>{{myValue}}</p>');App.HomeRoute = _emberMetalCore2['default'].Route.extend({controllerName:'myController'});registry.register('controller:myController',_emberMetalCore2['default'].Controller.extend({myValue:'foo'}));bootApplication();deepEqual(container.lookup('route:home').controller,container.lookup('controller:myController'),'route controller is set by controllerName');equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'foo','The homepage template was rendered with data from the custom controller');});QUnit.test('The route controller specified via controllerName is used in render',function(){Router.map(function(){this.route('home',{path:'/'});});_emberMetalCore2['default'].TEMPLATES.alternative_home = compile('<p>alternative home: {{myValue}}</p>');App.HomeRoute = _emberMetalCore2['default'].Route.extend({controllerName:'myController',renderTemplate:function renderTemplate(){this.render('alternative_home');}});registry.register('controller:myController',_emberMetalCore2['default'].Controller.extend({myValue:'foo'}));bootApplication();deepEqual(container.lookup('route:home').controller,container.lookup('controller:myController'),'route controller is set by controllerName');equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'alternative home: foo','The homepage template was rendered with data from the custom controller');});QUnit.test('The route controller specified via controllerName is used in render even when a controller with the routeName is available',function(){Router.map(function(){this.route('home',{path:'/'});});_emberMetalCore2['default'].TEMPLATES.home = compile('<p>home: {{myValue}}</p>');App.HomeRoute = _emberMetalCore2['default'].Route.extend({controllerName:'myController'});registry.register('controller:home',_emberMetalCore2['default'].Controller.extend({myValue:'home'}));registry.register('controller:myController',_emberMetalCore2['default'].Controller.extend({myValue:'myController'}));bootApplication();deepEqual(container.lookup('route:home').controller,container.lookup('controller:myController'),'route controller is set by controllerName');equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'home: myController','The homepage template was rendered with data from the custom controller');});QUnit.test('The Homepage with a `setupController` hook modifying other controllers',function(){Router.map(function(){this.route('home',{path:'/'});});App.HomeRoute = _emberMetalCore2['default'].Route.extend({setupController:function setupController(controller){(0,_emberMetalProperty_set.set)(this.controllerFor('home'),'hours',_emberMetalCore2['default'].A(['Monday through Friday: 9am to 5pm','Saturday: Noon to Midnight','Sunday: Noon to 6pm']));}});_emberMetalCore2['default'].TEMPLATES.home = compile('<ul>{{#each hours as |entry|}}<li>{{entry}}</li>{{/each}}</ul>');bootApplication();equal(_emberMetalCore2['default'].$('ul li','#qunit-fixture').eq(2).text(),'Sunday: Noon to 6pm','The template was rendered with the hours context');});QUnit.test('The Homepage with a computed context that does not get overridden',function(){expectDeprecation(_emberRuntimeControllersArray_controller.arrayControllerDeprecation);Router.map(function(){this.route('home',{path:'/'});});App.HomeController = _emberMetalCore2['default'].ArrayController.extend({model:_emberMetalCore2['default'].computed(function(){return _emberMetalCore2['default'].A(['Monday through Friday: 9am to 5pm','Saturday: Noon to Midnight','Sunday: Noon to 6pm']);})});_emberMetalCore2['default'].TEMPLATES.home = compile('<ul>{{#each model as |passage|}}<li>{{passage}}</li>{{/each}}</ul>');bootApplication();equal(_emberMetalCore2['default'].$('ul li','#qunit-fixture').eq(2).text(),'Sunday: Noon to 6pm','The template was rendered with the context intact');});QUnit.test('The Homepage getting its controller context via model',function(){expectDeprecation(_emberRuntimeControllersArray_controller.arrayControllerDeprecation);Router.map(function(){this.route('home',{path:'/'});});App.HomeRoute = _emberMetalCore2['default'].Route.extend({model:function model(){return _emberMetalCore2['default'].A(['Monday through Friday: 9am to 5pm','Saturday: Noon to Midnight','Sunday: Noon to 6pm']);},setupController:function setupController(controller,model){equal(this.controllerFor('home'),controller);(0,_emberMetalProperty_set.set)(this.controllerFor('home'),'hours',model);}});_emberMetalCore2['default'].TEMPLATES.home = compile('<ul>{{#each hours as |entry|}}<li>{{entry}}</li>{{/each}}</ul>');bootApplication();equal(_emberMetalCore2['default'].$('ul li','#qunit-fixture').eq(2).text(),'Sunday: Noon to 6pm','The template was rendered with the hours context');});QUnit.test('The Specials Page getting its controller context by deserializing the params hash',function(){Router.map(function(){this.route('home',{path:'/'});this.route('special',{path:'/specials/:menu_item_id'});});App.SpecialRoute = _emberMetalCore2['default'].Route.extend({model:function model(params){return _emberMetalCore2['default'].Object.create({menuItemId:params.menu_item_id});},setupController:function setupController(controller,model){(0,_emberMetalProperty_set.set)(controller,'model',model);}});_emberMetalCore2['default'].TEMPLATES.special = compile('<p>{{model.menuItemId}}</p>');bootApplication();registry.register('controller:special',_emberMetalCore2['default'].Controller.extend());handleURL('/specials/1');equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'1','The model was used to render the template');});QUnit.test('The Specials Page defaults to looking models up via `find`',function(){Router.map(function(){this.route('home',{path:'/'});this.route('special',{path:'/specials/:menu_item_id'});});App.MenuItem = _emberMetalCore2['default'].Object.extend();App.MenuItem.reopenClass({find:function find(id){return App.MenuItem.create({id:id});}});App.SpecialRoute = _emberMetalCore2['default'].Route.extend({setupController:function setupController(controller,model){(0,_emberMetalProperty_set.set)(controller,'model',model);}});_emberMetalCore2['default'].TEMPLATES.special = compile('<p>{{model.id}}</p>');bootApplication();registry.register('controller:special',_emberMetalCore2['default'].Controller.extend());handleURL('/specials/1');equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'1','The model was used to render the template');});QUnit.test('The Special Page returning a promise puts the app into a loading state until the promise is resolved',function(){Router.map(function(){this.route('home',{path:'/'});this.route('special',{path:'/specials/:menu_item_id'});});var menuItem,resolve;App.MenuItem = _emberMetalCore2['default'].Object.extend();App.MenuItem.reopenClass({find:function find(id){menuItem = App.MenuItem.create({id:id});return new _emberMetalCore2['default'].RSVP.Promise(function(res){resolve = res;});}});App.LoadingRoute = _emberMetalCore2['default'].Route.extend({});App.SpecialRoute = _emberMetalCore2['default'].Route.extend({setupController:function setupController(controller,model){(0,_emberMetalProperty_set.set)(controller,'model',model);}});_emberMetalCore2['default'].TEMPLATES.special = compile('<p>{{model.id}}</p>');_emberMetalCore2['default'].TEMPLATES.loading = compile('<p>LOADING!</p>');bootApplication();registry.register('controller:special',_emberMetalCore2['default'].Controller.extend());handleURL('/specials/1');equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'LOADING!','The app is in the loading state');_emberMetalCore2['default'].run(function(){resolve(menuItem);});equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'1','The app is now in the specials state');});QUnit.test('The loading state doesn\'t get entered for promises that resolve on the same run loop',function(){Router.map(function(){this.route('home',{path:'/'});this.route('special',{path:'/specials/:menu_item_id'});});App.MenuItem = _emberMetalCore2['default'].Object.extend();App.MenuItem.reopenClass({find:function find(id){return {id:id};}});App.LoadingRoute = _emberMetalCore2['default'].Route.extend({enter:function enter(){ok(false,'LoadingRoute shouldn\'t have been entered.');}});App.SpecialRoute = _emberMetalCore2['default'].Route.extend({setupController:function setupController(controller,model){(0,_emberMetalProperty_set.set)(controller,'model',model);}});_emberMetalCore2['default'].TEMPLATES.special = compile('<p>{{model.id}}</p>');_emberMetalCore2['default'].TEMPLATES.loading = compile('<p>LOADING!</p>');bootApplication();registry.register('controller:special',_emberMetalCore2['default'].Controller.extend());handleURL('/specials/1');equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'1','The app is now in the specials state');});QUnit.test('The Special page returning an error invokes SpecialRoute\'s error handler',function(){Router.map(function(){this.route('home',{path:'/'});this.route('special',{path:'/specials/:menu_item_id'});});var menuItem,promise,resolve;App.MenuItem = _emberMetalCore2['default'].Object.extend();App.MenuItem.reopenClass({find:function find(id){menuItem = App.MenuItem.create({id:id});promise = new _emberMetalCore2['default'].RSVP.Promise(function(res){resolve = res;});return promise;}});App.SpecialRoute = _emberMetalCore2['default'].Route.extend({setup:function setup(){throw 'Setup error';},actions:{error:function error(reason){equal(reason,'Setup error','SpecialRoute#error received the error thrown from setup');}}});bootApplication();handleURLRejectsWith('/specials/1','Setup error');_emberMetalCore2['default'].run(function(){resolve(menuItem);});});function testOverridableErrorHandler(handlersName){expect(2);Router.map(function(){this.route('home',{path:'/'});this.route('special',{path:'/specials/:menu_item_id'});});var menuItem,resolve;App.MenuItem = _emberMetalCore2['default'].Object.extend();App.MenuItem.reopenClass({find:function find(id){menuItem = App.MenuItem.create({id:id});return new _emberMetalCore2['default'].RSVP.Promise(function(res){resolve = res;});}});var attrs={};attrs[handlersName] = {error:function error(reason){equal(reason,'Setup error','error was correctly passed to custom ApplicationRoute handler');}};App.ApplicationRoute = _emberMetalCore2['default'].Route.extend(attrs);App.SpecialRoute = _emberMetalCore2['default'].Route.extend({setup:function setup(){throw 'Setup error';}});bootApplication();handleURLRejectsWith('/specials/1','Setup error');_emberMetalCore2['default'].run(function(){resolve(menuItem);});}QUnit.test('ApplicationRoute\'s default error handler can be overridden',function(){testOverridableErrorHandler('actions');});QUnit.test('ApplicationRoute\'s default error handler can be overridden (with DEPRECATED `events`)',function(){ignoreDeprecation(function(){testOverridableErrorHandler('events');});});asyncTest('Moving from one page to another triggers the correct callbacks',function(){expect(3);Router.map(function(){this.route('home',{path:'/'});this.route('special',{path:'/specials/:menu_item_id'});});App.MenuItem = _emberMetalCore2['default'].Object.extend();App.SpecialRoute = _emberMetalCore2['default'].Route.extend({setupController:function setupController(controller,model){(0,_emberMetalProperty_set.set)(controller,'model',model);}});_emberMetalCore2['default'].TEMPLATES.home = compile('<h3>Home</h3>');_emberMetalCore2['default'].TEMPLATES.special = compile('<p>{{model.id}}</p>');bootApplication();registry.register('controller:special',_emberMetalCore2['default'].Controller.extend());var transition=handleURL('/');_emberMetalCore2['default'].run(function(){transition.then(function(){equal(_emberMetalCore2['default'].$('h3','#qunit-fixture').text(),'Home','The app is now in the initial state');var promiseContext=App.MenuItem.create({id:1});_emberMetalCore2['default'].run.later(function(){_emberMetalCore2['default'].RSVP.resolve(promiseContext);},1);return router.transitionTo('special',promiseContext);}).then(function(result){deepEqual(router.location.path,'/specials/1');QUnit.start();});});});asyncTest('Nested callbacks are not exited when moving to siblings',function(){Router.map(function(){this.route('root',{path:'/'},function(){this.route('special',{path:'/specials/:menu_item_id',resetNamespace:true});});});var currentPath;App.ApplicationController = _emberMetalCore2['default'].Controller.extend({currentPathDidChange:_emberMetalCore2['default'].observer('currentPath',function(){currentPath = (0,_emberMetalProperty_get.get)(this,'currentPath');})});var menuItem;App.MenuItem = _emberMetalCore2['default'].Object.extend();App.MenuItem.reopenClass({find:function find(id){menuItem = App.MenuItem.create({id:id});return menuItem;}});App.LoadingRoute = _emberMetalCore2['default'].Route.extend({});App.RootRoute = _emberMetalCore2['default'].Route.extend({model:function model(){rootModel++;return this._super.apply(this,arguments);},serialize:function serialize(){rootSerialize++;return this._super.apply(this,arguments);},setupController:function setupController(){rootSetup++;},renderTemplate:function renderTemplate(){rootRender++;}});App.HomeRoute = _emberMetalCore2['default'].Route.extend({});App.SpecialRoute = _emberMetalCore2['default'].Route.extend({setupController:function setupController(controller,model){(0,_emberMetalProperty_set.set)(controller,'model',model);}});_emberMetalCore2['default'].TEMPLATES['root/index'] = compile('<h3>Home</h3>');_emberMetalCore2['default'].TEMPLATES.special = compile('<p>{{model.id}}</p>');_emberMetalCore2['default'].TEMPLATES.loading = compile('<p>LOADING!</p>');var rootSetup=0;var rootRender=0;var rootModel=0;var rootSerialize=0;bootApplication();registry.register('controller:special',_emberMetalCore2['default'].Controller.extend());equal(_emberMetalCore2['default'].$('h3','#qunit-fixture').text(),'Home','The app is now in the initial state');equal(rootSetup,1,'The root setup was triggered');equal(rootRender,1,'The root render was triggered');equal(rootSerialize,0,'The root serialize was not called');equal(rootModel,1,'The root model was called');router = container.lookup('router:main');_emberMetalCore2['default'].run(function(){var menuItem=App.MenuItem.create({id:1});_emberMetalCore2['default'].run.later(function(){_emberMetalCore2['default'].RSVP.resolve(menuItem);},1);router.transitionTo('special',menuItem).then(function(result){equal(rootSetup,1,'The root setup was not triggered again');equal(rootRender,1,'The root render was not triggered again');equal(rootSerialize,0,'The root serialize was not called');equal(rootModel,1,'The root model was called again');deepEqual(router.location.path,'/specials/1');equal(currentPath,'root.special');QUnit.start();});});});QUnit.asyncTest('Events are triggered on the controller if a matching action name is implemented',function(){Router.map(function(){this.route('home',{path:'/'});});var _model={name:'Tom Dale'};var stateIsNotCalled=true;App.HomeRoute = _emberMetalCore2['default'].Route.extend({model:function model(){return _model;},actions:{showStuff:function showStuff(obj){stateIsNotCalled = false;}}});_emberMetalCore2['default'].TEMPLATES.home = compile('<a {{action \'showStuff\' model}}>{{name}}</a>');var controller=_emberMetalCore2['default'].Controller.extend({actions:{showStuff:function showStuff(context){ok(stateIsNotCalled,'an event on the state is not triggered');deepEqual(context,{name:'Tom Dale'},'an event with context is passed');QUnit.start();}}});registry.register('controller:home',controller);bootApplication();var actionId=_emberMetalCore2['default'].$('#qunit-fixture a').data('ember-action');var _ActionManager$registeredActions$actionId=_slicedToArray(_emberViewsSystemAction_manager2['default'].registeredActions[actionId],1);var action=_ActionManager$registeredActions$actionId[0];var event=new _emberMetalCore2['default'].$.Event('click');action.handler(event);});QUnit.asyncTest('Events are triggered on the current state when defined in `actions` object',function(){Router.map(function(){this.route('home',{path:'/'});});var _model2={name:'Tom Dale'};App.HomeRoute = _emberMetalCore2['default'].Route.extend({model:function model(){return _model2;},actions:{showStuff:function showStuff(obj){ok(this instanceof App.HomeRoute,'the handler is an App.HomeRoute');deepEqual(_emberMetalCore2['default'].copy(obj,true),{name:'Tom Dale'},'the context is correct');QUnit.start();}}});_emberMetalCore2['default'].TEMPLATES.home = compile('<a {{action \'showStuff\' model}}>{{model.name}}</a>');bootApplication();var actionId=_emberMetalCore2['default'].$('#qunit-fixture a').data('ember-action');var _ActionManager$registeredActions$actionId2=_slicedToArray(_emberViewsSystemAction_manager2['default'].registeredActions[actionId],1);var action=_ActionManager$registeredActions$actionId2[0];var event=new _emberMetalCore2['default'].$.Event('click');action.handler(event);});QUnit.asyncTest('Events defined in `actions` object are triggered on the current state when routes are nested',function(){Router.map(function(){this.route('root',{path:'/'},function(){this.route('index',{path:'/'});});});var _model3={name:'Tom Dale'};App.RootRoute = _emberMetalCore2['default'].Route.extend({actions:{showStuff:function showStuff(obj){ok(this instanceof App.RootRoute,'the handler is an App.HomeRoute');deepEqual(_emberMetalCore2['default'].copy(obj,true),{name:'Tom Dale'},'the context is correct');QUnit.start();}}});App.RootIndexRoute = _emberMetalCore2['default'].Route.extend({model:function model(){return _model3;}});_emberMetalCore2['default'].TEMPLATES['root/index'] = compile('<a {{action \'showStuff\' model}}>{{model.name}}</a>');bootApplication();var actionId=_emberMetalCore2['default'].$('#qunit-fixture a').data('ember-action');var _ActionManager$registeredActions$actionId3=_slicedToArray(_emberViewsSystemAction_manager2['default'].registeredActions[actionId],1);var action=_ActionManager$registeredActions$actionId3[0];var event=new _emberMetalCore2['default'].$.Event('click');action.handler(event);});QUnit.asyncTest('Events are triggered on the current state when defined in `events` object (DEPRECATED)',function(){Router.map(function(){this.route('home',{path:'/'});});var _model4={name:'Tom Dale'};App.HomeRoute = _emberMetalCore2['default'].Route.extend({model:function model(){return _model4;},events:{showStuff:function showStuff(obj){ok(this instanceof App.HomeRoute,'the handler is an App.HomeRoute');deepEqual(_emberMetalCore2['default'].copy(obj,true),{name:'Tom Dale'},'the context is correct');QUnit.start();}}});_emberMetalCore2['default'].TEMPLATES.home = compile('<a {{action \'showStuff\' model}}>{{name}}</a>');expectDeprecation(/Action handlers contained in an `events` object are deprecated/);bootApplication();var actionId=_emberMetalCore2['default'].$('#qunit-fixture a').data('ember-action');var _ActionManager$registeredActions$actionId4=_slicedToArray(_emberViewsSystemAction_manager2['default'].registeredActions[actionId],1);var action=_ActionManager$registeredActions$actionId4[0];var event=new _emberMetalCore2['default'].$.Event('click');action.handler(event);});QUnit.asyncTest('Events defined in `events` object are triggered on the current state when routes are nested (DEPRECATED)',function(){Router.map(function(){this.route('root',{path:'/'},function(){this.route('index',{path:'/'});});});var _model5={name:'Tom Dale'};App.RootRoute = _emberMetalCore2['default'].Route.extend({events:{showStuff:function showStuff(obj){ok(this instanceof App.RootRoute,'the handler is an App.HomeRoute');deepEqual(_emberMetalCore2['default'].copy(obj,true),{name:'Tom Dale'},'the context is correct');QUnit.start();}}});App.RootIndexRoute = _emberMetalCore2['default'].Route.extend({model:function model(){return _model5;}});_emberMetalCore2['default'].TEMPLATES['root/index'] = compile('<a {{action \'showStuff\' model}}>{{name}}</a>');expectDeprecation(/Action handlers contained in an `events` object are deprecated/);bootApplication();var actionId=_emberMetalCore2['default'].$('#qunit-fixture a').data('ember-action');var _ActionManager$registeredActions$actionId5=_slicedToArray(_emberViewsSystemAction_manager2['default'].registeredActions[actionId],1);var action=_ActionManager$registeredActions$actionId5[0];var event=new _emberMetalCore2['default'].$.Event('click');action.handler(event);});QUnit.test('Events can be handled by inherited event handlers',function(){expect(4);App.SuperRoute = _emberMetalCore2['default'].Route.extend({actions:{foo:function foo(){ok(true,'foo');},bar:function bar(msg){equal(msg,'HELLO');}}});App.RouteMixin = _emberMetalCore2['default'].Mixin.create({actions:{bar:function bar(msg){equal(msg,'HELLO');this._super(msg);}}});App.IndexRoute = App.SuperRoute.extend(App.RouteMixin,{actions:{baz:function baz(){ok(true,'baz');}}});bootApplication();router.send('foo');router.send('bar','HELLO');router.send('baz');});QUnit.asyncTest('Actions are not triggered on the controller if a matching action name is implemented as a method',function(){Router.map(function(){this.route('home',{path:'/'});});var _model6={name:'Tom Dale'};var stateIsNotCalled=true;App.HomeRoute = _emberMetalCore2['default'].Route.extend({model:function model(){return _model6;},actions:{showStuff:function showStuff(context){ok(stateIsNotCalled,'an event on the state is not triggered');deepEqual(context,{name:'Tom Dale'},'an event with context is passed');QUnit.start();}}});_emberMetalCore2['default'].TEMPLATES.home = compile('<a {{action \'showStuff\' model}}>{{name}}</a>');var controller=_emberMetalCore2['default'].Controller.extend({showStuff:function showStuff(context){stateIsNotCalled = false;ok(stateIsNotCalled,'an event on the state is not triggered');}});registry.register('controller:home',controller);bootApplication();var actionId=_emberMetalCore2['default'].$('#qunit-fixture a').data('ember-action');var _ActionManager$registeredActions$actionId6=_slicedToArray(_emberViewsSystemAction_manager2['default'].registeredActions[actionId],1);var action=_ActionManager$registeredActions$actionId6[0];var event=new _emberMetalCore2['default'].$.Event('click');action.handler(event);});QUnit.asyncTest('actions can be triggered with multiple arguments',function(){Router.map(function(){this.route('root',{path:'/'},function(){this.route('index',{path:'/'});});});var model1={name:'Tilde'};var model2={name:'Tom Dale'};App.RootRoute = _emberMetalCore2['default'].Route.extend({actions:{showStuff:function showStuff(obj1,obj2){ok(this instanceof App.RootRoute,'the handler is an App.HomeRoute');deepEqual(_emberMetalCore2['default'].copy(obj1,true),{name:'Tilde'},'the first context is correct');deepEqual(_emberMetalCore2['default'].copy(obj2,true),{name:'Tom Dale'},'the second context is correct');QUnit.start();}}});App.RootIndexController = _emberMetalCore2['default'].Controller.extend({model1:model1,model2:model2});_emberMetalCore2['default'].TEMPLATES['root/index'] = compile('<a {{action \'showStuff\' model1 model2}}>{{model1.name}}</a>');bootApplication();var actionId=_emberMetalCore2['default'].$('#qunit-fixture a').data('ember-action');var _ActionManager$registeredActions$actionId7=_slicedToArray(_emberViewsSystemAction_manager2['default'].registeredActions[actionId],1);var action=_ActionManager$registeredActions$actionId7[0];var event=new _emberMetalCore2['default'].$.Event('click');action.handler(event);});QUnit.test('transitioning multiple times in a single run loop only sets the URL once',function(){Router.map(function(){this.route('root',{path:'/'});this.route('foo');this.route('bar');});bootApplication();var urlSetCount=0;router.get('location').setURL = function(path){urlSetCount++;(0,_emberMetalProperty_set.set)(this,'path',path);};equal(urlSetCount,0);_emberMetalCore2['default'].run(function(){router.transitionTo('foo');router.transitionTo('bar');});equal(urlSetCount,1);equal(router.get('location').getURL(),'/bar');});QUnit.test('navigating away triggers a url property change',function(){expect(3);Router.map(function(){this.route('root',{path:'/'});this.route('foo',{path:'/foo'});this.route('bar',{path:'/bar'});});bootApplication();_emberMetalCore2['default'].run(function(){_emberMetalCore2['default'].addObserver(router,'url',function(){ok(true,'url change event was fired');});});['foo','bar','/foo'].forEach(function(destination){_emberMetalCore2['default'].run(router,'transitionTo',destination);});});QUnit.test('using replaceWith calls location.replaceURL if available',function(){var setCount=0;var replaceCount=0;Router.reopen({location:_emberMetalCore2['default'].NoneLocation.create({setURL:function setURL(path){setCount++;(0,_emberMetalProperty_set.set)(this,'path',path);},replaceURL:function replaceURL(path){replaceCount++;(0,_emberMetalProperty_set.set)(this,'path',path);}})});Router.map(function(){this.route('root',{path:'/'});this.route('foo');});bootApplication();equal(setCount,0);equal(replaceCount,0);_emberMetalCore2['default'].run(function(){router.replaceWith('foo');});equal(setCount,0,'should not call setURL');equal(replaceCount,1,'should call replaceURL once');equal(router.get('location').getURL(),'/foo');});QUnit.test('using replaceWith calls setURL if location.replaceURL is not defined',function(){var setCount=0;Router.reopen({location:_emberMetalCore2['default'].NoneLocation.create({setURL:function setURL(path){setCount++;(0,_emberMetalProperty_set.set)(this,'path',path);}})});Router.map(function(){this.route('root',{path:'/'});this.route('foo');});bootApplication();equal(setCount,0);_emberMetalCore2['default'].run(function(){router.replaceWith('foo');});equal(setCount,1,'should call setURL once');equal(router.get('location').getURL(),'/foo');});QUnit.test('Route inherits model from parent route',function(){expect(9);Router.map(function(){this.route('the_post',{path:'/posts/:post_id'},function(){this.route('comments');this.route('shares',{path:'/shares/:share_id',resetNamespace:true},function(){this.route('share');});});});var post1={};var post2={};var post3={};var currentPost;var share1={};var share2={};var share3={};var posts={1:post1,2:post2,3:post3};var shares={1:share1,2:share2,3:share3};App.ThePostRoute = _emberMetalCore2['default'].Route.extend({model:function model(params){return posts[params.post_id];}});App.ThePostCommentsRoute = _emberMetalCore2['default'].Route.extend({afterModel:function afterModel(post,transition){var parent_model=this.modelFor('thePost');equal(post,parent_model);}});App.SharesRoute = _emberMetalCore2['default'].Route.extend({model:function model(params){return shares[params.share_id];}});App.SharesShareRoute = _emberMetalCore2['default'].Route.extend({afterModel:function afterModel(share,transition){var parent_model=this.modelFor('shares');equal(share,parent_model);}});bootApplication();currentPost = post1;handleURL('/posts/1/comments');handleURL('/posts/1/shares/1');currentPost = post2;handleURL('/posts/2/comments');handleURL('/posts/2/shares/2');currentPost = post3;handleURL('/posts/3/comments');handleURL('/posts/3/shares/3');});QUnit.test('Routes with { resetNamespace: true } inherits model from parent route',function(){expect(6);Router.map(function(){this.route('the_post',{path:'/posts/:post_id'},function(){this.route('comments',{resetNamespace:true},function(){});});});var post1={};var post2={};var post3={};var currentPost;var posts={1:post1,2:post2,3:post3};App.ThePostRoute = _emberMetalCore2['default'].Route.extend({model:function model(params){return posts[params.post_id];}});App.CommentsRoute = _emberMetalCore2['default'].Route.extend({afterModel:function afterModel(post,transition){var parent_model=this.modelFor('thePost');equal(post,parent_model);}});bootApplication();currentPost = post1;handleURL('/posts/1/comments');currentPost = post2;handleURL('/posts/2/comments');currentPost = post3;handleURL('/posts/3/comments');});QUnit.test('It is possible to get the model from a parent route',function(){expect(9);Router.map(function(){this.route('the_post',{path:'/posts/:post_id'},function(){this.route('comments',{resetNamespace:true});});});var post1={};var post2={};var post3={};var currentPost;var posts={1:post1,2:post2,3:post3};App.ThePostRoute = _emberMetalCore2['default'].Route.extend({model:function model(params){return posts[params.post_id];}});App.CommentsRoute = _emberMetalCore2['default'].Route.extend({model:function model(){equal(this.modelFor('thePost'),currentPost);equal(this.modelFor('the_post'),currentPost);}});bootApplication();currentPost = post1;handleURL('/posts/1/comments');currentPost = post2;handleURL('/posts/2/comments');currentPost = post3;handleURL('/posts/3/comments');});QUnit.test('A redirection hook is provided',function(){Router.map(function(){this.route('choose',{path:'/'});this.route('home');});var chooseFollowed=0;var destination;App.ChooseRoute = _emberMetalCore2['default'].Route.extend({redirect:function redirect(){if(destination){this.transitionTo(destination);}},setupController:function setupController(){chooseFollowed++;}});destination = 'home';bootApplication();equal(chooseFollowed,0,'The choose route wasn\'t entered since a transition occurred');equal(_emberMetalCore2['default'].$('h3:contains(Hours)','#qunit-fixture').length,1,'The home template was rendered');equal(router.container.lookup('controller:application').get('currentPath'),'home');});QUnit.test('Redirecting from the middle of a route aborts the remainder of the routes',function(){expect(3);Router.map(function(){this.route('home');this.route('foo',function(){this.route('bar',{resetNamespace:true},function(){this.route('baz');});});});App.BarRoute = _emberMetalCore2['default'].Route.extend({redirect:function redirect(){this.transitionTo('home');},setupController:function setupController(){ok(false,'Should transition before setupController');}});App.BarBazRoute = _emberMetalCore2['default'].Route.extend({enter:function enter(){ok(false,'Should abort transition getting to next route');}});bootApplication();handleURLAborts('/foo/bar/baz');equal(router.container.lookup('controller:application').get('currentPath'),'home');equal(router.get('location').getURL(),'/home');});QUnit.test('Redirecting to the current target in the middle of a route does not abort initial routing',function(){expect(5);Router.map(function(){this.route('home');this.route('foo',function(){this.route('bar',{resetNamespace:true},function(){this.route('baz');});});});var successCount=0;App.BarRoute = _emberMetalCore2['default'].Route.extend({redirect:function redirect(){this.transitionTo('bar.baz').then(function(){successCount++;});},setupController:function setupController(){ok(true,'Should still invoke bar\'s setupController');}});App.BarBazRoute = _emberMetalCore2['default'].Route.extend({setupController:function setupController(){ok(true,'Should still invoke bar.baz\'s setupController');}});bootApplication();handleURL('/foo/bar/baz');equal(router.container.lookup('controller:application').get('currentPath'),'foo.bar.baz');equal(successCount,1,'transitionTo success handler was called once');});QUnit.test('Redirecting to the current target with a different context aborts the remainder of the routes',function(){expect(4);Router.map(function(){this.route('home');this.route('foo',function(){this.route('bar',{path:'bar/:id',resetNamespace:true},function(){this.route('baz');});});});var model={id:2};var count=0;App.BarRoute = _emberMetalCore2['default'].Route.extend({afterModel:function afterModel(context){if(count++ > 10){ok(false,'infinite loop');}else {this.transitionTo('bar.baz',model);}},serialize:function serialize(params){return params;}});App.BarBazRoute = _emberMetalCore2['default'].Route.extend({setupController:function setupController(){ok(true,'Should still invoke setupController');}});bootApplication();handleURLAborts('/foo/bar/1/baz');equal(router.container.lookup('controller:application').get('currentPath'),'foo.bar.baz');equal(router.get('location').getURL(),'/foo/bar/2/baz');});QUnit.test('Transitioning from a parent event does not prevent currentPath from being set',function(){Router.map(function(){this.route('foo',function(){this.route('bar',{resetNamespace:true},function(){this.route('baz');});this.route('qux');});});App.FooRoute = _emberMetalCore2['default'].Route.extend({actions:{goToQux:function goToQux(){this.transitionTo('foo.qux');}}});bootApplication();var applicationController=router.container.lookup('controller:application');handleURL('/foo/bar/baz');equal(applicationController.get('currentPath'),'foo.bar.baz');_emberMetalCore2['default'].run(function(){router.send('goToQux');});equal(applicationController.get('currentPath'),'foo.qux');equal(router.get('location').getURL(),'/foo/qux');});QUnit.test('Generated names can be customized when providing routes with dot notation',function(){expect(4);_emberMetalCore2['default'].TEMPLATES.index = compile('<div>Index</div>');_emberMetalCore2['default'].TEMPLATES.application = compile('<h1>Home</h1><div class=\'main\'>{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES.foo = compile('<div class=\'middle\'>{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES.bar = compile('<div class=\'bottom\'>{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES['bar/baz'] = compile('<p>{{name}}Bottom!</p>');Router.map(function(){this.route('foo',{path:'/top'},function(){this.route('bar',{path:'/middle',resetNamespace:true},function(){this.route('baz',{path:'/bottom'});});});});App.FooRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){ok(true,'FooBarRoute was called');return this._super.apply(this,arguments);}});App.BarBazRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){ok(true,'BarBazRoute was called');return this._super.apply(this,arguments);}});App.BarController = _emberMetalCore2['default'].Controller.extend({name:'Bar'});App.BarBazController = _emberMetalCore2['default'].Controller.extend({name:'BarBaz'});bootApplication();handleURL('/top/middle/bottom');equal(_emberMetalCore2['default'].$('.main .middle .bottom p','#qunit-fixture').text(),'BarBazBottom!','The templates were rendered into their appropriate parents');});QUnit.test('Child routes render into their parent route\'s template by default',function(){_emberMetalCore2['default'].TEMPLATES.index = compile('<div>Index</div>');_emberMetalCore2['default'].TEMPLATES.application = compile('<h1>Home</h1><div class=\'main\'>{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES.top = compile('<div class=\'middle\'>{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES.middle = compile('<div class=\'bottom\'>{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES['middle/bottom'] = compile('<p>Bottom!</p>');Router.map(function(){this.route('top',function(){this.route('middle',{resetNamespace:true},function(){this.route('bottom');});});});bootApplication();handleURL('/top/middle/bottom');equal(_emberMetalCore2['default'].$('.main .middle .bottom p','#qunit-fixture').text(),'Bottom!','The templates were rendered into their appropriate parents');});QUnit.test('Child routes render into specified template',function(){_emberMetalCore2['default'].TEMPLATES.index = compile('<div>Index</div>');_emberMetalCore2['default'].TEMPLATES.application = compile('<h1>Home</h1><div class=\'main\'>{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES.top = compile('<div class=\'middle\'>{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES.middle = compile('<div class=\'bottom\'>{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES['middle/bottom'] = compile('<p>Bottom!</p>');Router.map(function(){this.route('top',function(){this.route('middle',{resetNamespace:true},function(){this.route('bottom');});});});App.MiddleBottomRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render('middle/bottom',{into:'top'});}});bootApplication();handleURL('/top/middle/bottom');equal(_emberMetalCore2['default'].$('.main .middle .bottom p','#qunit-fixture').length,0,'should not render into the middle template');equal(_emberMetalCore2['default'].$('.main .middle > p','#qunit-fixture').text(),'Bottom!','The template was rendered into the top template');});QUnit.test('Rendering into specified template with slash notation',function(){_emberMetalCore2['default'].TEMPLATES['person/profile'] = compile('profile {{outlet}}');_emberMetalCore2['default'].TEMPLATES['person/details'] = compile('details!');Router.map(function(){this.route('home',{path:'/'});});App.HomeRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render('person/profile');this.render('person/details',{into:'person/profile'});}});bootApplication();equal(_emberMetalCore2['default'].$('#qunit-fixture:contains(profile details!)').length,1,'The templates were rendered');});QUnit.test('Parent route context change',function(){var editCount=0;var editedPostIds=_emberMetalCore2['default'].A();_emberMetalCore2['default'].TEMPLATES.application = compile('{{outlet}}');_emberMetalCore2['default'].TEMPLATES.posts = compile('{{outlet}}');_emberMetalCore2['default'].TEMPLATES.post = compile('{{outlet}}');_emberMetalCore2['default'].TEMPLATES['post/index'] = compile('showing');_emberMetalCore2['default'].TEMPLATES['post/edit'] = compile('editing');Router.map(function(){this.route('posts',function(){this.route('post',{path:'/:postId',resetNamespace:true},function(){this.route('edit');});});});App.PostsRoute = _emberMetalCore2['default'].Route.extend({actions:{showPost:function showPost(context){this.transitionTo('post',context);}}});App.PostRoute = _emberMetalCore2['default'].Route.extend({model:function model(params){return {id:params.postId};},actions:{editPost:function editPost(context){this.transitionTo('post.edit');}}});App.PostEditRoute = _emberMetalCore2['default'].Route.extend({model:function model(params){var postId=this.modelFor('post').id;editedPostIds.push(postId);return null;},setup:function setup(){this._super.apply(this,arguments);editCount++;}});bootApplication();handleURL('/posts/1');_emberMetalCore2['default'].run(function(){router.send('editPost');});_emberMetalCore2['default'].run(function(){router.send('showPost',{id:'2'});});_emberMetalCore2['default'].run(function(){router.send('editPost');});equal(editCount,2,'set up the edit route twice without failure');deepEqual(editedPostIds,['1','2'],'modelFor posts.post returns the right context');});QUnit.test('Router accounts for rootURL on page load when using history location',function(){var rootURL=window.location.pathname + '/app';var postsTemplateRendered=false;var setHistory,HistoryTestLocation;setHistory = function(obj,path){obj.set('history',{state:{path:path}});};HistoryTestLocation = _emberMetalCore2['default'].HistoryLocation.extend({initState:function initState(){var path=rootURL + '/posts';setHistory(this,path);this.set('location',{pathname:path,href:'http://localhost/' + path});},replaceState:function replaceState(path){setHistory(this,path);},pushState:function pushState(path){setHistory(this,path);}});registry.register('location:historyTest',HistoryTestLocation);Router.reopen({location:'historyTest',rootURL:rootURL});Router.map(function(){this.route('posts',{path:'/posts'});});App.PostsRoute = _emberMetalCore2['default'].Route.extend({model:function model(){},renderTemplate:function renderTemplate(){postsTemplateRendered = true;}});bootApplication();ok(postsTemplateRendered,'Posts route successfully stripped from rootURL');});QUnit.test('The rootURL is passed properly to the location implementation',function(){expect(1);var rootURL='/blahzorz';var HistoryTestLocation;HistoryTestLocation = _emberMetalCore2['default'].HistoryLocation.extend({rootURL:'this is not the URL you are looking for',initState:function initState(){equal(this.get('rootURL'),rootURL);}});registry.register('location:history-test',HistoryTestLocation);Router.reopen({location:'history-test',rootURL:rootURL,_doURLTransition:function _doURLTransition(){}});bootApplication();});QUnit.test('Only use route rendered into main outlet for default into property on child',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('{{outlet \'menu\'}}{{outlet}}');_emberMetalCore2['default'].TEMPLATES.posts = compile('{{outlet}}');_emberMetalCore2['default'].TEMPLATES['posts/index'] = compile('postsIndex');_emberMetalCore2['default'].TEMPLATES['posts/menu'] = compile('postsMenu');Router.map(function(){this.route('posts',function(){});});App.PostsMenuView = _emberViewsViewsView2['default'].extend({tagName:'div',templateName:'posts/menu',classNames:['posts-menu']});App.PostsIndexView = _emberViewsViewsView2['default'].extend({tagName:'p',classNames:['posts-index']});App.PostsRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render();this.render('postsMenu',{into:'application',outlet:'menu'});}});bootApplication();handleURL('/posts');equal(_emberMetalCore2['default'].$('div.posts-menu:contains(postsMenu)','#qunit-fixture').length,1,'The posts/menu template was rendered');equal(_emberMetalCore2['default'].$('p.posts-index:contains(postsIndex)','#qunit-fixture').length,1,'The posts/index template was rendered');});QUnit.test('Generating a URL should not affect currentModel',function(){Router.map(function(){this.route('post',{path:'/posts/:post_id'});});var posts={1:{id:1},2:{id:2}};App.PostRoute = _emberMetalCore2['default'].Route.extend({model:function model(params){return posts[params.post_id];}});bootApplication();handleURL('/posts/1');var route=container.lookup('route:post');equal(route.modelFor('post'),posts[1]);var url=router.generate('post',posts[2]);equal(url,'/posts/2');equal(route.modelFor('post'),posts[1]);});QUnit.test('Generated route should be an instance of App.Route if provided',function(){var generatedRoute;Router.map(function(){this.route('posts');});App.Route = _emberMetalCore2['default'].Route.extend();bootApplication();handleURL('/posts');generatedRoute = container.lookup('route:posts');ok(generatedRoute instanceof App.Route,'should extend the correct route');});QUnit.test('Nested index route is not overriden by parent\'s implicit index route',function(){Router.map(function(){this.route('posts',function(){this.route('index',{path:':category'});});});App.Route = _emberMetalCore2['default'].Route.extend({serialize:function serialize(model){return {category:model.category};}});bootApplication();_emberMetalCore2['default'].run(function(){router.transitionTo('posts',{category:'emberjs'});});deepEqual(router.location.path,'/posts/emberjs');});QUnit.test('Application template does not duplicate when re-rendered',function(){expectDeprecation(_emberRuntimeControllersArray_controller.arrayControllerDeprecation);_emberMetalCore2['default'].TEMPLATES.application = compile('<h3>I Render Once</h3>{{outlet}}');Router.map(function(){this.route('posts');});App.ApplicationRoute = _emberMetalCore2['default'].Route.extend({model:function model(){return _emberMetalCore2['default'].A();}});bootApplication();handleURL('/posts');equal(_emberMetalCore2['default'].$('h3:contains(I Render Once)').size(),1);});QUnit.test('Child routes should render inside the application template if the application template causes a redirect',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('<h3>App</h3> {{outlet}}');_emberMetalCore2['default'].TEMPLATES.posts = compile('posts');Router.map(function(){this.route('posts');this.route('photos');});App.ApplicationRoute = _emberMetalCore2['default'].Route.extend({afterModel:function afterModel(){this.transitionTo('posts');}});bootApplication();equal(_emberMetalCore2['default'].$('#qunit-fixture > div').text(),'App posts');});QUnit.test('The template is not re-rendered when the route\'s context changes',function(){Router.map(function(){this.route('page',{path:'/page/:name'});});App.PageRoute = _emberMetalCore2['default'].Route.extend({model:function model(params){return _emberMetalCore2['default'].Object.create({name:params.name});}});var insertionCount=0;App.PageView = _emberViewsViewsView2['default'].extend({didInsertElement:function didInsertElement(){insertionCount += 1;}});_emberMetalCore2['default'].TEMPLATES.page = compile('<p>{{model.name}}</p>');bootApplication();handleURL('/page/first');equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'first');equal(insertionCount,1);handleURL('/page/second');equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'second');equal(insertionCount,1,'view should have inserted only once');_emberMetalCore2['default'].run(function(){router.transitionTo('page',_emberMetalCore2['default'].Object.create({name:'third'}));});equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'third');equal(insertionCount,1,'view should still have inserted only once');});QUnit.test('The template is not re-rendered when two routes present the exact same template, view, & controller',function(){Router.map(function(){this.route('first');this.route('second');this.route('third');this.route('fourth');});App.SharedRoute = _emberMetalCore2['default'].Route.extend({viewName:'shared',setupController:function setupController(controller){this.controllerFor('shared').set('message','This is the ' + this.routeName + ' message');},renderTemplate:function renderTemplate(controller,context){this.render({controller:'shared'});}});App.FirstRoute = App.SharedRoute.extend();App.SecondRoute = App.SharedRoute.extend();App.ThirdRoute = App.SharedRoute.extend();App.FourthRoute = App.SharedRoute.extend({viewName:'fourth'});App.SharedController = _emberMetalCore2['default'].Controller.extend();var insertionCount=0;App.SharedView = _emberViewsViewsView2['default'].extend({templateName:'shared',didInsertElement:function didInsertElement(){insertionCount += 1;}});App.FourthView = App.SharedView.extend();_emberMetalCore2['default'].TEMPLATES.shared = compile('<p>{{message}}</p>');bootApplication();handleURL('/first');equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'This is the first message');equal(insertionCount,1,'expected one assertion');handleURL('/second');equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'This is the second message');equal(insertionCount,1,'view should have inserted only once');_emberMetalCore2['default'].run(function(){router.transitionTo('third').then(function(value){ok(true,'expected transition');},function(reason){ok(false,'unexpected transition failure: ',QUnit.jsDump.parse(reason));});});equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'This is the third message');equal(insertionCount,1,'view should still have inserted only once');handleURL('/fourth');equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'This is the fourth message');equal(insertionCount,2,'view should have inserted a second time');});QUnit.test('ApplicationRoute with model does not proxy the currentPath',function(){var _model7={};var currentPath;App.ApplicationRoute = _emberMetalCore2['default'].Route.extend({model:function model(){return _model7;}});App.ApplicationController = _emberMetalCore2['default'].Controller.extend({currentPathDidChange:_emberMetalCore2['default'].observer('currentPath',function(){currentPath = (0,_emberMetalProperty_get.get)(this,'currentPath');})});bootApplication();equal(currentPath,'index','currentPath is index');equal('currentPath' in _model7,false,'should have defined currentPath on controller');});QUnit.test('Promises encountered on app load put app into loading state until resolved',function(){expect(2);var deferred=_emberMetalCore2['default'].RSVP.defer();App.IndexRoute = _emberMetalCore2['default'].Route.extend({model:function model(){return deferred.promise;}});_emberMetalCore2['default'].TEMPLATES.index = compile('<p>INDEX</p>');_emberMetalCore2['default'].TEMPLATES.loading = compile('<p>LOADING</p>');bootApplication();equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'LOADING','The loading state is displaying.');_emberMetalCore2['default'].run(deferred.resolve);equal(_emberMetalCore2['default'].$('p','#qunit-fixture').text(),'INDEX','The index route is display.');});QUnit.test('Route should tear down multiple outlets',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('{{outlet \'menu\'}}{{outlet}}{{outlet \'footer\'}}');_emberMetalCore2['default'].TEMPLATES.posts = compile('{{outlet}}');_emberMetalCore2['default'].TEMPLATES.users = compile('users');_emberMetalCore2['default'].TEMPLATES['posts/index'] = compile('postsIndex');_emberMetalCore2['default'].TEMPLATES['posts/menu'] = compile('postsMenu');_emberMetalCore2['default'].TEMPLATES['posts/footer'] = compile('postsFooter');Router.map(function(){this.route('posts',function(){});this.route('users',function(){});});App.PostsMenuView = _emberViewsViewsView2['default'].extend({tagName:'div',templateName:'posts/menu',classNames:['posts-menu']});App.PostsIndexView = _emberViewsViewsView2['default'].extend({tagName:'p',classNames:['posts-index']});App.PostsFooterView = _emberViewsViewsView2['default'].extend({tagName:'div',templateName:'posts/footer',classNames:['posts-footer']});App.PostsRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render('postsMenu',{into:'application',outlet:'menu'});this.render();this.render('postsFooter',{into:'application',outlet:'footer'});}});bootApplication();handleURL('/posts');equal(_emberMetalCore2['default'].$('div.posts-menu:contains(postsMenu)','#qunit-fixture').length,1,'The posts/menu template was rendered');equal(_emberMetalCore2['default'].$('p.posts-index:contains(postsIndex)','#qunit-fixture').length,1,'The posts/index template was rendered');equal(_emberMetalCore2['default'].$('div.posts-footer:contains(postsFooter)','#qunit-fixture').length,1,'The posts/footer template was rendered');handleURL('/users');equal(_emberMetalCore2['default'].$('div.posts-menu:contains(postsMenu)','#qunit-fixture').length,0,'The posts/menu template was removed');equal(_emberMetalCore2['default'].$('p.posts-index:contains(postsIndex)','#qunit-fixture').length,0,'The posts/index template was removed');equal(_emberMetalCore2['default'].$('div.posts-footer:contains(postsFooter)','#qunit-fixture').length,0,'The posts/footer template was removed');});QUnit.test('Route will assert if you try to explicitly render {into: ...} a missing template',function(){Router.map(function(){this.route('home',{path:'/'});});App.HomeRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render({into:'nonexistent'});}});expectAssertion(function(){bootApplication();},'You attempted to render into \'nonexistent\' but it was not found');});QUnit.test('Route supports clearing outlet explicitly',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('{{outlet}}{{outlet \'modal\'}}');_emberMetalCore2['default'].TEMPLATES.posts = compile('{{outlet}}');_emberMetalCore2['default'].TEMPLATES.users = compile('users');_emberMetalCore2['default'].TEMPLATES['posts/index'] = compile('postsIndex {{outlet}}');_emberMetalCore2['default'].TEMPLATES['posts/modal'] = compile('postsModal');_emberMetalCore2['default'].TEMPLATES['posts/extra'] = compile('postsExtra');Router.map(function(){this.route('posts',function(){});this.route('users',function(){});});App.PostsIndexView = _emberViewsViewsView2['default'].extend({classNames:['posts-index']});App.PostsModalView = _emberViewsViewsView2['default'].extend({templateName:'posts/modal',classNames:['posts-modal']});App.PostsExtraView = _emberViewsViewsView2['default'].extend({templateName:'posts/extra',classNames:['posts-extra']});App.PostsRoute = _emberMetalCore2['default'].Route.extend({actions:{showModal:function showModal(){this.render('postsModal',{into:'application',outlet:'modal'});},hideModal:function hideModal(){this.disconnectOutlet({outlet:'modal',parentView:'application'});}}});App.PostsIndexRoute = _emberMetalCore2['default'].Route.extend({actions:{showExtra:function showExtra(){this.render('postsExtra',{into:'posts/index'});},hideExtra:function hideExtra(){this.disconnectOutlet({parentView:'posts/index'});}}});bootApplication();handleURL('/posts');equal(_emberMetalCore2['default'].$('div.posts-index:contains(postsIndex)','#qunit-fixture').length,1,'The posts/index template was rendered');_emberMetalCore2['default'].run(function(){router.send('showModal');});equal(_emberMetalCore2['default'].$('div.posts-modal:contains(postsModal)','#qunit-fixture').length,1,'The posts/modal template was rendered');_emberMetalCore2['default'].run(function(){router.send('showExtra');});equal(_emberMetalCore2['default'].$('div.posts-extra:contains(postsExtra)','#qunit-fixture').length,1,'The posts/extra template was rendered');_emberMetalCore2['default'].run(function(){router.send('hideModal');});equal(_emberMetalCore2['default'].$('div.posts-modal:contains(postsModal)','#qunit-fixture').length,0,'The posts/modal template was removed');_emberMetalCore2['default'].run(function(){router.send('hideExtra');});equal(_emberMetalCore2['default'].$('div.posts-extra:contains(postsExtra)','#qunit-fixture').length,0,'The posts/extra template was removed');handleURL('/users');equal(_emberMetalCore2['default'].$('div.posts-index:contains(postsIndex)','#qunit-fixture').length,0,'The posts/index template was removed');equal(_emberMetalCore2['default'].$('div.posts-modal:contains(postsModal)','#qunit-fixture').length,0,'The posts/modal template was removed');equal(_emberMetalCore2['default'].$('div.posts-extra:contains(postsExtra)','#qunit-fixture').length,0,'The posts/extra template was removed');});QUnit.test('Route supports clearing outlet using string parameter',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('{{outlet}}{{outlet \'modal\'}}');_emberMetalCore2['default'].TEMPLATES.posts = compile('{{outlet}}');_emberMetalCore2['default'].TEMPLATES.users = compile('users');_emberMetalCore2['default'].TEMPLATES['posts/index'] = compile('postsIndex {{outlet}}');_emberMetalCore2['default'].TEMPLATES['posts/modal'] = compile('postsModal');Router.map(function(){this.route('posts',function(){});this.route('users',function(){});});App.PostsIndexView = _emberViewsViewsView2['default'].extend({classNames:['posts-index']});App.PostsModalView = _emberViewsViewsView2['default'].extend({templateName:'posts/modal',classNames:['posts-modal']});App.PostsRoute = _emberMetalCore2['default'].Route.extend({actions:{showModal:function showModal(){this.render('postsModal',{into:'application',outlet:'modal'});},hideModal:function hideModal(){this.disconnectOutlet('modal');}}});bootApplication();handleURL('/posts');equal(_emberMetalCore2['default'].$('div.posts-index:contains(postsIndex)','#qunit-fixture').length,1,'The posts/index template was rendered');_emberMetalCore2['default'].run(function(){router.send('showModal');});equal(_emberMetalCore2['default'].$('div.posts-modal:contains(postsModal)','#qunit-fixture').length,1,'The posts/modal template was rendered');_emberMetalCore2['default'].run(function(){router.send('hideModal');});equal(_emberMetalCore2['default'].$('div.posts-modal:contains(postsModal)','#qunit-fixture').length,0,'The posts/modal template was removed');handleURL('/users');equal(_emberMetalCore2['default'].$('div.posts-index:contains(postsIndex)','#qunit-fixture').length,0,'The posts/index template was removed');equal(_emberMetalCore2['default'].$('div.posts-modal:contains(postsModal)','#qunit-fixture').length,0,'The posts/modal template was removed');});QUnit.test('Route silently fails when cleaning an outlet from an inactive view',function(){expect(1);_emberMetalCore2['default'].TEMPLATES.application = compile('{{outlet}}');_emberMetalCore2['default'].TEMPLATES.posts = compile('{{outlet \'modal\'}}');_emberMetalCore2['default'].TEMPLATES.modal = compile('A Yo.');Router.map(function(){this.route('posts');});App.PostsRoute = _emberMetalCore2['default'].Route.extend({actions:{hideSelf:function hideSelf(){this.disconnectOutlet({outlet:'main',parentView:'application'});},showModal:function showModal(){this.render('modal',{into:'posts',outlet:'modal'});},hideModal:function hideModal(){this.disconnectOutlet({outlet:'modal',parentView:'posts'});}}});bootApplication();handleURL('/posts');_emberMetalCore2['default'].run(function(){router.send('showModal');});_emberMetalCore2['default'].run(function(){router.send('hideSelf');});_emberMetalCore2['default'].run(function(){router.send('hideModal');});});if((0,_emberMetalFeatures2['default'])('ember-router-willtransition')){QUnit.test('Router `willTransition` hook passes in cancellable transition',function(){expect(3);Router.map(function(){this.route('nork');this.route('about');});Router.reopen({init:function init(){this._super();this.on('willTransition',this.testWillTransitionHook);},testWillTransitionHook:function testWillTransitionHook(transition,url){ok(true,'willTransition was called ' + url);transition.abort();}});App.LoadingRoute = _emberMetalCore2['default'].Route.extend({activate:function activate(){ok(false,'LoadingRoute was not entered');}});App.NorkRoute = _emberMetalCore2['default'].Route.extend({activate:function activate(){ok(false,'NorkRoute was not entered');}});App.AboutRoute = _emberMetalCore2['default'].Route.extend({activate:function activate(){ok(false,'AboutRoute was not entered');}});bootApplication();_emberMetalCore2['default'].run(router,'handleURL','/nork');_emberMetalCore2['default'].run(router,'handleURL','/about');});}QUnit.test('Aborting/redirecting the transition in `willTransition` prevents LoadingRoute from being entered',function(){expect(8);Router.map(function(){this.route('nork');this.route('about');});var redirect=false;App.IndexRoute = _emberMetalCore2['default'].Route.extend({actions:{willTransition:function willTransition(transition){ok(true,'willTransition was called');if(redirect){this.transitionTo('about');}else {transition.abort();}}}});var deferred=null;App.LoadingRoute = _emberMetalCore2['default'].Route.extend({activate:function activate(){ok(deferred,'LoadingRoute should be entered at this time');},deactivate:function deactivate(){ok(true,'LoadingRoute was exited');}});App.NorkRoute = _emberMetalCore2['default'].Route.extend({activate:function activate(){ok(true,'NorkRoute was entered');}});App.AboutRoute = _emberMetalCore2['default'].Route.extend({activate:function activate(){ok(true,'AboutRoute was entered');},model:function model(){if(deferred){return deferred.promise;}}});bootApplication();_emberMetalCore2['default'].run(router,'transitionTo','nork');_emberMetalCore2['default'].run(router,'handleURL','/nork');redirect = true;_emberMetalCore2['default'].run(router,'transitionTo','nork');_emberMetalCore2['default'].run(router,'transitionTo','index');deferred = _emberMetalCore2['default'].RSVP.defer();_emberMetalCore2['default'].run(router,'transitionTo','nork');_emberMetalCore2['default'].run(deferred.resolve);});QUnit.test('`didTransition` event fires on the router',function(){expect(3);Router.map(function(){this.route('nork');});router = container.lookup('router:main');router.one('didTransition',function(){ok(true,'didTransition fired on initial routing');});bootApplication();router.one('didTransition',function(){ok(true,'didTransition fired on the router');equal(router.get('url'),'/nork','The url property is updated by the time didTransition fires');});_emberMetalCore2['default'].run(router,'transitionTo','nork');});QUnit.test('`didTransition` can be reopened',function(){expect(1);Router.map(function(){this.route('nork');});Router.reopen({didTransition:function didTransition(){this._super.apply(this,arguments);ok(true,'reopened didTransition was called');}});bootApplication();});QUnit.test('`activate` event fires on the route',function(){expect(2);var eventFired=0;Router.map(function(){this.route('nork');});App.NorkRoute = _emberMetalCore2['default'].Route.extend({init:function init(){this._super.apply(this,arguments);this.on('activate',function(){equal(++eventFired,1,'activate event is fired once');});},activate:function activate(){ok(true,'activate hook is called');}});bootApplication();_emberMetalCore2['default'].run(router,'transitionTo','nork');});QUnit.test('`deactivate` event fires on the route',function(){expect(2);var eventFired=0;Router.map(function(){this.route('nork');this.route('dork');});App.NorkRoute = _emberMetalCore2['default'].Route.extend({init:function init(){this._super.apply(this,arguments);this.on('deactivate',function(){equal(++eventFired,1,'deactivate event is fired once');});},deactivate:function deactivate(){ok(true,'deactivate hook is called');}});bootApplication();_emberMetalCore2['default'].run(router,'transitionTo','nork');_emberMetalCore2['default'].run(router,'transitionTo','dork');});QUnit.test('Actions can be handled by inherited action handlers',function(){expect(4);App.SuperRoute = _emberMetalCore2['default'].Route.extend({actions:{foo:function foo(){ok(true,'foo');},bar:function bar(msg){equal(msg,'HELLO');}}});App.RouteMixin = _emberMetalCore2['default'].Mixin.create({actions:{bar:function bar(msg){equal(msg,'HELLO');this._super(msg);}}});App.IndexRoute = App.SuperRoute.extend(App.RouteMixin,{actions:{baz:function baz(){ok(true,'baz');}}});bootApplication();router.send('foo');router.send('bar','HELLO');router.send('baz');});QUnit.test('currentRouteName is a property installed on ApplicationController that can be used in transitionTo',function(){expect(24);Router.map(function(){this.route('be',function(){this.route('excellent',{resetNamespace:true},function(){this.route('to',{resetNamespace:true},function(){this.route('each',{resetNamespace:true},function(){this.route('other');});});});});});bootApplication();var appController=router.container.lookup('controller:application');function transitionAndCheck(path,expectedPath,expectedRouteName){if(path){_emberMetalCore2['default'].run(router,'transitionTo',path);}equal(appController.get('currentPath'),expectedPath);equal(appController.get('currentRouteName'),expectedRouteName);}transitionAndCheck(null,'index','index');transitionAndCheck('/be','be.index','be.index');transitionAndCheck('/be/excellent','be.excellent.index','excellent.index');transitionAndCheck('/be/excellent/to','be.excellent.to.index','to.index');transitionAndCheck('/be/excellent/to/each','be.excellent.to.each.index','each.index');transitionAndCheck('/be/excellent/to/each/other','be.excellent.to.each.other','each.other');transitionAndCheck('index','index','index');transitionAndCheck('be','be.index','be.index');transitionAndCheck('excellent','be.excellent.index','excellent.index');transitionAndCheck('to.index','be.excellent.to.index','to.index');transitionAndCheck('each','be.excellent.to.each.index','each.index');transitionAndCheck('each.other','be.excellent.to.each.other','each.other');});QUnit.test('Route model hook finds the same model as a manual find',function(){var Post;App.Post = _emberMetalCore2['default'].Object.extend();App.Post.reopenClass({find:function find(){Post = this;return {};}});Router.map(function(){this.route('post',{path:'/post/:post_id'});});bootApplication();handleURL('/post/1');equal(App.Post,Post);});QUnit.test('Can register an implementation via Ember.Location.registerImplementation (DEPRECATED)',function(){var TestLocation=_emberMetalCore2['default'].NoneLocation.extend({implementation:'test'});expectDeprecation(/Using the Ember.Location.registerImplementation is no longer supported/);_emberMetalCore2['default'].Location.registerImplementation('test',TestLocation);Router.reopen({location:'test'});bootApplication();equal(router.get('location.implementation'),'test','custom location implementation can be registered with registerImplementation');});QUnit.test('Ember.Location.registerImplementation is deprecated',function(){var TestLocation=_emberMetalCore2['default'].NoneLocation.extend({implementation:'test'});expectDeprecation(function(){_emberMetalCore2['default'].Location.registerImplementation('test',TestLocation);},'Using the Ember.Location.registerImplementation is no longer supported. Register your custom location implementation with the container instead.');});QUnit.test('Routes can refresh themselves causing their model hooks to be re-run',function(){Router.map(function(){this.route('parent',{path:'/parent/:parent_id'},function(){this.route('child');});});var appcount=0;App.ApplicationRoute = _emberMetalCore2['default'].Route.extend({model:function model(){++appcount;}});var parentcount=0;App.ParentRoute = _emberMetalCore2['default'].Route.extend({model:function model(params){equal(params.parent_id,'123');++parentcount;},actions:{refreshParent:function refreshParent(){this.refresh();}}});var childcount=0;App.ParentChildRoute = _emberMetalCore2['default'].Route.extend({model:function model(){++childcount;}});bootApplication();equal(appcount,1);equal(parentcount,0);equal(childcount,0);_emberMetalCore2['default'].run(router,'transitionTo','parent.child','123');equal(appcount,1);equal(parentcount,1);equal(childcount,1);_emberMetalCore2['default'].run(router,'send','refreshParent');equal(appcount,1);equal(parentcount,2);equal(childcount,2);});QUnit.test('Specifying non-existent controller name in route#render throws',function(){expect(1);Router.map(function(){this.route('home',{path:'/'});});App.HomeRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){try{this.render('homepage',{controller:'stefanpenneristhemanforme'});}catch(e) {equal(e.message,'You passed `controller: \'stefanpenneristhemanforme\'` into the `render` method, but no such controller could be found.');}}});bootApplication();});QUnit.test('Redirecting with null model doesn\'t error out',function(){Router.map(function(){this.route('home',{path:'/'});this.route('about',{path:'/about/:hurhurhur'});});App.HomeRoute = _emberMetalCore2['default'].Route.extend({beforeModel:function beforeModel(){this.transitionTo('about',null);}});App.AboutRoute = _emberMetalCore2['default'].Route.extend({serialize:function serialize(model){if(model === null){return {hurhurhur:'TreeklesMcGeekles'};}}});bootApplication();equal(router.get('location.path'),'/about/TreeklesMcGeekles');});QUnit.test('rejecting the model hooks promise with a non-error prints the `message` property',function(){var rejectedMessage='OMG!! SOOOOOO BAD!!!!';var rejectedStack='Yeah, buddy: stack gets printed too.';Router.map(function(){this.route('yippie',{path:'/'});});_emberMetalCore2['default'].Logger.error = function(initialMessage,errorMessage,errorStack){equal(initialMessage,'Error while processing route: yippie','a message with the current route name is printed');equal(errorMessage,rejectedMessage,'the rejected reason\'s message property is logged');equal(errorStack,rejectedStack,'the rejected reason\'s stack property is logged');};App.YippieRoute = _emberMetalCore2['default'].Route.extend({model:function model(){return _emberMetalCore2['default'].RSVP.reject({message:rejectedMessage,stack:rejectedStack});}});bootApplication();});QUnit.test('rejecting the model hooks promise with an error with `errorThrown` property prints `errorThrown.message` property',function(){var rejectedMessage='OMG!! SOOOOOO BAD!!!!';var rejectedStack='Yeah, buddy: stack gets printed too.';Router.map(function(){this.route('yippie',{path:'/'});});_emberMetalCore2['default'].Logger.error = function(initialMessage,errorMessage,errorStack){equal(initialMessage,'Error while processing route: yippie','a message with the current route name is printed');equal(errorMessage,rejectedMessage,'the rejected reason\'s message property is logged');equal(errorStack,rejectedStack,'the rejected reason\'s stack property is logged');};App.YippieRoute = _emberMetalCore2['default'].Route.extend({model:function model(){return _emberMetalCore2['default'].RSVP.reject({errorThrown:{message:rejectedMessage,stack:rejectedStack}});}});bootApplication();});QUnit.test('rejecting the model hooks promise with no reason still logs error',function(){Router.map(function(){this.route('wowzers',{path:'/'});});_emberMetalCore2['default'].Logger.error = function(initialMessage){equal(initialMessage,'Error while processing route: wowzers','a message with the current route name is printed');};App.WowzersRoute = _emberMetalCore2['default'].Route.extend({model:function model(){return _emberMetalCore2['default'].RSVP.reject();}});bootApplication();});QUnit.test('rejecting the model hooks promise with a string shows a good error',function(){var originalLoggerError=_emberMetalCore2['default'].Logger.error;var rejectedMessage='Supercalifragilisticexpialidocious';Router.map(function(){this.route('yondo',{path:'/'});});_emberMetalCore2['default'].Logger.error = function(initialMessage,errorMessage){equal(initialMessage,'Error while processing route: yondo','a message with the current route name is printed');equal(errorMessage,rejectedMessage,'the rejected reason\'s message property is logged');};App.YondoRoute = _emberMetalCore2['default'].Route.extend({model:function model(){return _emberMetalCore2['default'].RSVP.reject(rejectedMessage);}});bootApplication();_emberMetalCore2['default'].Logger.error = originalLoggerError;});QUnit.test('willLeave, willChangeContext, willChangeModel actions don\'t fire unless feature flag enabled',function(){expect(1);App.Router.map(function(){this.route('about');});function shouldNotFire(){ok(false,'this action shouldn\'t have been received');}App.IndexRoute = _emberMetalCore2['default'].Route.extend({actions:{willChangeModel:shouldNotFire,willChangeContext:shouldNotFire,willLeave:shouldNotFire}});App.AboutRoute = _emberMetalCore2['default'].Route.extend({setupController:function setupController(){ok(true,'about route was entered');}});bootApplication();_emberMetalCore2['default'].run(router,'transitionTo','about');});QUnit.test('Errors in transitionTo within redirect hook are logged',function(){expect(3);var actual=[];Router.map(function(){this.route('yondo',{path:'/'});this.route('stink-bomb');});App.YondoRoute = _emberMetalCore2['default'].Route.extend({redirect:function redirect(){this.transitionTo('stink-bomb',{something:'goes boom'});}});_emberMetalCore2['default'].Logger.error = function(){actual.push(arguments);};bootApplication();equal(actual.length,1,'the error is only logged once');equal(actual[0][0],'Error while processing route: yondo','source route is printed');ok(actual[0][1].match(/More context objects were passed than there are dynamic segments for the route: stink-bomb/),'the error is printed');});QUnit.test('Errors in transition show error template if available',function(){_emberMetalCore2['default'].TEMPLATES.error = compile('<div id=\'error\'>Error!</div>');Router.map(function(){this.route('yondo',{path:'/'});this.route('stink-bomb');});App.YondoRoute = _emberMetalCore2['default'].Route.extend({redirect:function redirect(){this.transitionTo('stink-bomb',{something:'goes boom'});}});bootApplication();equal(_emberMetalCore2['default'].$('#error').length,1,'Error template was rendered.');});QUnit.test('Route#resetController gets fired when changing models and exiting routes',function(){expect(4);Router.map(function(){this.route('a',function(){this.route('b',{path:'/b/:id',resetNamespace:true},function(){});this.route('c',{path:'/c/:id',resetNamespace:true},function(){});});this.route('out');});var calls=[];var SpyRoute=_emberMetalCore2['default'].Route.extend({setupController:function setupController(controller,model,transition){calls.push(['setup',this.routeName]);},resetController:function resetController(controller){calls.push(['reset',this.routeName]);}});App.ARoute = SpyRoute.extend();App.BRoute = SpyRoute.extend();App.CRoute = SpyRoute.extend();App.OutRoute = SpyRoute.extend();bootApplication();deepEqual(calls,[]);_emberMetalCore2['default'].run(router,'transitionTo','b','b-1');deepEqual(calls,[['setup','a'],['setup','b']]);calls.length = 0;_emberMetalCore2['default'].run(router,'transitionTo','c','c-1');deepEqual(calls,[['reset','b'],['setup','c']]);calls.length = 0;_emberMetalCore2['default'].run(router,'transitionTo','out');deepEqual(calls,[['reset','c'],['reset','a'],['setup','out']]);});QUnit.test('Exception during initialization of non-initial route is not swallowed',function(){Router.map(function(){this.route('boom');});App.BoomRoute = _emberMetalCore2['default'].Route.extend({init:function init(){throw new Error('boom!');}});bootApplication();throws(function(){_emberMetalCore2['default'].run(router,'transitionTo','boom');},/\bboom\b/);});QUnit.test('Exception during load of non-initial route is not swallowed',function(){Router.map(function(){this.route('boom');});var lookup=container.lookup;container.lookup = function(){if(arguments[0] === 'route:boom'){throw new Error('boom!');}return lookup.apply(this,arguments);};App.BoomRoute = _emberMetalCore2['default'].Route.extend({init:function init(){throw new Error('boom!');}});bootApplication();throws(function(){_emberMetalCore2['default'].run(router,'transitionTo','boom');});});QUnit.test('Exception during initialization of initial route is not swallowed',function(){Router.map(function(){this.route('boom',{path:'/'});});App.BoomRoute = _emberMetalCore2['default'].Route.extend({init:function init(){throw new Error('boom!');}});throws(function(){bootApplication();},/\bboom\b/);});QUnit.test('Exception during load of initial route is not swallowed',function(){Router.map(function(){this.route('boom',{path:'/'});});var lookup=container.lookup;container.lookup = function(){if(arguments[0] === 'route:boom'){throw new Error('boom!');}return lookup.apply(this,arguments);};App.BoomRoute = _emberMetalCore2['default'].Route.extend({init:function init(){throw new Error('boom!');}});throws(function(){bootApplication();},/\bboom\b/);});QUnit.test('{{outlet}} works when created after initial render',function(){_emberMetalCore2['default'].TEMPLATES.sample = compile('Hi{{#if showTheThing}}{{outlet}}{{/if}}Bye');_emberMetalCore2['default'].TEMPLATES['sample/inner'] = compile('Yay');_emberMetalCore2['default'].TEMPLATES['sample/inner2'] = compile('Boo');Router.map(function(){this.route('sample',{path:'/'},function(){this.route('inner',{path:'/'});this.route('inner2',{path:'/2'});});});bootApplication();equal(_emberMetalCore2['default'].$('#qunit-fixture').text(),'HiBye','initial render');_emberMetalCore2['default'].run(function(){container.lookup('controller:sample').set('showTheThing',true);});equal(_emberMetalCore2['default'].$('#qunit-fixture').text(),'HiYayBye','second render');handleURL('/2');equal(_emberMetalCore2['default'].$('#qunit-fixture').text(),'HiBooBye','third render');});QUnit.test('Can rerender application view multiple times when it contains an outlet',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('App{{outlet}}');_emberMetalCore2['default'].TEMPLATES.index = compile('Hello world');registry.register('view:application',_emberViewsViewsView2['default'].extend({elementId:'im-special'}));bootApplication();equal(_emberMetalCore2['default'].$('#qunit-fixture').text(),'AppHello world','initial render');_emberMetalCore2['default'].run(function(){_emberViewsViewsView2['default'].views['im-special'].rerender();});equal(_emberMetalCore2['default'].$('#qunit-fixture').text(),'AppHello world','second render');_emberMetalCore2['default'].run(function(){_emberViewsViewsView2['default'].views['im-special'].rerender();});equal(_emberMetalCore2['default'].$('#qunit-fixture').text(),'AppHello world','third render');});QUnit.test('Can render into a named outlet at the top level',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('A-{{outlet}}-B-{{outlet "other"}}-C');_emberMetalCore2['default'].TEMPLATES.modal = compile('Hello world');_emberMetalCore2['default'].TEMPLATES.index = compile('The index');registry.register('route:application',_emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render();this.render('modal',{into:'application',outlet:'other'});}}));bootApplication();equal(_emberMetalCore2['default'].$('#qunit-fixture').text(),'A-The index-B-Hello world-C','initial render');});QUnit.test('Can disconnect a named outlet at the top level',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('A-{{outlet}}-B-{{outlet "other"}}-C');_emberMetalCore2['default'].TEMPLATES.modal = compile('Hello world');_emberMetalCore2['default'].TEMPLATES.index = compile('The index');registry.register('route:application',_emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render();this.render('modal',{into:'application',outlet:'other'});},actions:{banish:function banish(){this.disconnectOutlet({parentView:'application',outlet:'other'});}}}));bootApplication();equal(_emberMetalCore2['default'].$('#qunit-fixture').text(),'A-The index-B-Hello world-C','initial render');_emberMetalCore2['default'].run(router,'send','banish');equal(_emberMetalCore2['default'].$('#qunit-fixture').text(),'A-The index-B--C','second render');});QUnit.test('Can render into a named outlet at the top level, with empty main outlet',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('A-{{outlet}}-B-{{outlet "other"}}-C');_emberMetalCore2['default'].TEMPLATES.modal = compile('Hello world');Router.map(function(){this.route('hasNoTemplate',{path:'/'});});registry.register('route:application',_emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render();this.render('modal',{into:'application',outlet:'other'});}}));bootApplication();equal(_emberMetalCore2['default'].$('#qunit-fixture').text(),'A--B-Hello world-C','initial render');});QUnit.test('Can render into a named outlet at the top level, later',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('A-{{outlet}}-B-{{outlet "other"}}-C');_emberMetalCore2['default'].TEMPLATES.modal = compile('Hello world');_emberMetalCore2['default'].TEMPLATES.index = compile('The index');registry.register('route:application',_emberMetalCore2['default'].Route.extend({actions:{launch:function launch(){this.render('modal',{into:'application',outlet:'other'});}}}));bootApplication();equal(_emberMetalCore2['default'].$('#qunit-fixture').text(),'A-The index-B--C','initial render');_emberMetalCore2['default'].run(router,'send','launch');equal(_emberMetalCore2['default'].$('#qunit-fixture').text(),'A-The index-B-Hello world-C','second render');});QUnit.test('Can render routes with no \'main\' outlet and their children',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('<div id="application">{{outlet "app"}}</div>');_emberMetalCore2['default'].TEMPLATES.app = compile('<div id="app-common">{{outlet "common"}}</div><div id="app-sub">{{outlet "sub"}}</div>');_emberMetalCore2['default'].TEMPLATES.common = compile('<div id="common"></div>');_emberMetalCore2['default'].TEMPLATES.sub = compile('<div id="sub"></div>');Router.map(function(){this.route('app',{path:'/app'},function(){this.route('sub',{path:'/sub',resetNamespace:true});});});App.AppRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render('app',{outlet:'app',into:'application'});this.render('common',{outlet:'common',into:'app'});}});App.SubRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render('sub',{outlet:'sub',into:'app'});}});bootApplication();handleURL('/app');equal(_emberMetalCore2['default'].$('#app-common #common').length,1,'Finds common while viewing /app');handleURL('/app/sub');equal(_emberMetalCore2['default'].$('#app-common #common').length,1,'Finds common while viewing /app/sub');equal(_emberMetalCore2['default'].$('#app-sub #sub').length,1,'Finds sub while viewing /app/sub');});QUnit.test('Tolerates stacked renders',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('{{outlet}}{{outlet "modal"}}');_emberMetalCore2['default'].TEMPLATES.index = compile('hi');_emberMetalCore2['default'].TEMPLATES.layer = compile('layer');App.ApplicationRoute = _emberMetalCore2['default'].Route.extend({actions:{openLayer:function openLayer(){this.render('layer',{into:'application',outlet:'modal'});},close:function close(){this.disconnectOutlet({outlet:'modal',parentView:'application'});}}});bootApplication();equal(trim(_emberMetalCore2['default'].$('#qunit-fixture').text()),'hi');_emberMetalCore2['default'].run(router,'send','openLayer');equal(trim(_emberMetalCore2['default'].$('#qunit-fixture').text()),'hilayer');_emberMetalCore2['default'].run(router,'send','openLayer');equal(trim(_emberMetalCore2['default'].$('#qunit-fixture').text()),'hilayer');_emberMetalCore2['default'].run(router,'send','close');equal(trim(_emberMetalCore2['default'].$('#qunit-fixture').text()),'hi');});QUnit.test('Renders child into parent with non-default template name',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('<div class="a">{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES['exports/root'] = compile('<div class="b">{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES['exports/index'] = compile('<div class="c"></div>');Router.map(function(){this.route('root',function(){});});App.RootRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render('exports/root');}});App.RootIndexRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render('exports/index');}});bootApplication();handleURL('/root');equal(_emberMetalCore2['default'].$('#qunit-fixture .a .b .c').length,1);});QUnit.test('Allows any route to disconnectOutlet another route\'s templates',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('{{outlet}}{{outlet "modal"}}');_emberMetalCore2['default'].TEMPLATES.index = compile('hi');_emberMetalCore2['default'].TEMPLATES.layer = compile('layer');App.ApplicationRoute = _emberMetalCore2['default'].Route.extend({actions:{openLayer:function openLayer(){this.render('layer',{into:'application',outlet:'modal'});}}});App.IndexRoute = _emberMetalCore2['default'].Route.extend({actions:{close:function close(){this.disconnectOutlet({parentView:'application',outlet:'modal'});}}});bootApplication();equal(trim(_emberMetalCore2['default'].$('#qunit-fixture').text()),'hi');_emberMetalCore2['default'].run(router,'send','openLayer');equal(trim(_emberMetalCore2['default'].$('#qunit-fixture').text()),'hilayer');_emberMetalCore2['default'].run(router,'send','close');equal(trim(_emberMetalCore2['default'].$('#qunit-fixture').text()),'hi');});QUnit.test('Can this.render({into:...}) the render helper',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('{{render "foo"}}');_emberMetalCore2['default'].TEMPLATES.foo = compile('<div class="foo">{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES.index = compile('other');_emberMetalCore2['default'].TEMPLATES.bar = compile('bar');App.IndexRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render({into:'foo'});},actions:{changeToBar:function changeToBar(){this.disconnectOutlet({parentView:'foo',outlet:'main'});this.render('bar',{into:'foo'});}}});bootApplication();equal(_emberMetalCore2['default'].$('#qunit-fixture .foo').text(),'other');_emberMetalCore2['default'].run(router,'send','changeToBar');equal(_emberMetalCore2['default'].$('#qunit-fixture .foo').text(),'bar');});QUnit.test('Can disconnect from the render helper',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('{{render "foo"}}');_emberMetalCore2['default'].TEMPLATES.foo = compile('<div class="foo">{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES.index = compile('other');App.IndexRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render({into:'foo'});},actions:{disconnect:function disconnect(){this.disconnectOutlet({parentView:'foo',outlet:'main'});}}});bootApplication();equal(_emberMetalCore2['default'].$('#qunit-fixture .foo').text(),'other');_emberMetalCore2['default'].run(router,'send','disconnect');equal(_emberMetalCore2['default'].$('#qunit-fixture .foo').text(),'');});QUnit.test('Can this.render({into:...}) the render helper\'s children',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('{{render "foo"}}');_emberMetalCore2['default'].TEMPLATES.foo = compile('<div class="foo">{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES.index = compile('<div class="index">{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES.other = compile('other');_emberMetalCore2['default'].TEMPLATES.bar = compile('bar');App.IndexRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render({into:'foo'});this.render('other',{into:'index'});},actions:{changeToBar:function changeToBar(){this.disconnectOutlet({parentView:'index',outlet:'main'});this.render('bar',{into:'index'});}}});bootApplication();equal(_emberMetalCore2['default'].$('#qunit-fixture .foo .index').text(),'other');_emberMetalCore2['default'].run(router,'send','changeToBar');equal(_emberMetalCore2['default'].$('#qunit-fixture .foo .index').text(),'bar');});QUnit.test('Can disconnect from the render helper\'s children',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('{{render "foo"}}');_emberMetalCore2['default'].TEMPLATES.foo = compile('<div class="foo">{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES.index = compile('<div class="index">{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES.other = compile('other');App.IndexRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render({into:'foo'});this.render('other',{into:'index'});},actions:{disconnect:function disconnect(){this.disconnectOutlet({parentView:'index',outlet:'main'});}}});bootApplication();equal(_emberMetalCore2['default'].$('#qunit-fixture .foo .index').text(),'other');_emberMetalCore2['default'].run(router,'send','disconnect');equal(_emberMetalCore2['default'].$('#qunit-fixture .foo .index').text(),'');});QUnit.test('Can this.render({into:...}) nested render helpers',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('{{render "foo"}}');_emberMetalCore2['default'].TEMPLATES.foo = compile('<div class="foo">{{render "bar"}}</div>');_emberMetalCore2['default'].TEMPLATES.bar = compile('<div class="bar">{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES.index = compile('other');_emberMetalCore2['default'].TEMPLATES.baz = compile('baz');App.IndexRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render({into:'bar'});},actions:{changeToBaz:function changeToBaz(){this.disconnectOutlet({parentView:'bar',outlet:'main'});this.render('baz',{into:'bar'});}}});bootApplication();equal(_emberMetalCore2['default'].$('#qunit-fixture .bar').text(),'other');_emberMetalCore2['default'].run(router,'send','changeToBaz');equal(_emberMetalCore2['default'].$('#qunit-fixture .bar').text(),'baz');});QUnit.test('Can disconnect from nested render helpers',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('{{render "foo"}}');_emberMetalCore2['default'].TEMPLATES.foo = compile('<div class="foo">{{render "bar"}}</div>');_emberMetalCore2['default'].TEMPLATES.bar = compile('<div class="bar">{{outlet}}</div>');_emberMetalCore2['default'].TEMPLATES.index = compile('other');App.IndexRoute = _emberMetalCore2['default'].Route.extend({renderTemplate:function renderTemplate(){this.render({into:'bar'});},actions:{disconnect:function disconnect(){this.disconnectOutlet({parentView:'bar',outlet:'main'});}}});bootApplication();equal(_emberMetalCore2['default'].$('#qunit-fixture .bar').text(),'other');_emberMetalCore2['default'].run(router,'send','disconnect');equal(_emberMetalCore2['default'].$('#qunit-fixture .bar').text(),'');});QUnit.test('Can render with layout',function(){_emberMetalCore2['default'].TEMPLATES.application = compile('{{outlet}}');_emberMetalCore2['default'].TEMPLATES.index = compile('index-template');_emberMetalCore2['default'].TEMPLATES['my-layout'] = compile('my-layout [{{yield}}]');App.IndexView = _emberViewsViewsView2['default'].extend({layoutName:'my-layout'});bootApplication();equal(_emberMetalCore2['default'].$('#qunit-fixture').text(),'my-layout [index-template]');});QUnit.test('Components inside an outlet have their didInsertElement hook invoked when the route is displayed',function(assert){_emberMetalCore2['default'].TEMPLATES.index = compile('{{#if showFirst}}{{my-component}}{{else}}{{other-component}}{{/if}}');var myComponentCounter=0;var otherComponentCounter=0;var indexController;App.IndexController = _emberMetalCore2['default'].Controller.extend({showFirst:true});App.IndexRoute = _emberMetalCore2['default'].Route.extend({setupController:function setupController(controller){indexController = controller;}});App.MyComponentComponent = _emberMetalCore2['default'].Component.extend({didInsertElement:function didInsertElement(){myComponentCounter++;}});App.OtherComponentComponent = _emberMetalCore2['default'].Component.extend({didInsertElement:function didInsertElement(){otherComponentCounter++;}});bootApplication();assert.strictEqual(myComponentCounter,1,'didInsertElement invoked on displayed component');assert.strictEqual(otherComponentCounter,0,'didInsertElement not invoked on displayed component');_emberMetalCore2['default'].run(function(){indexController.set('showFirst',false);});assert.strictEqual(myComponentCounter,1,'didInsertElement not invoked on displayed component');assert.strictEqual(otherComponentCounter,1,'didInsertElement invoked on displayed component');});